<link href="/static/css/style.default.css" rel="stylesheet">
<link href="/static/css/select2.css" rel="stylesheet">

<div class="pageheader">
    <h2><i class="fa fa-table"></i> 模版列表 </h2>
</div>

<div class="contentpanel">
    <div class="panel panel-default">
        <div class="panel-footer">


            <div class="table-responsive">
                <table class="table table-striped table-layout" id="dataTable">
                    <thead>
                    <tr>
                        <th>照片URL</th>
                        <th>标题</th>
                        <th>内容</th>
                        <th>价格</th>
                        <th>创建时间</th>
                        <th>操作</th>
                    </tr>
                    </thead>

                    <tbody id="maintablebody">
                    </tbody>

                    <footer>
                        <div class="dataTables_length">
                            <label>每页</label>
                            <label>
                                <select id="stepInput" name="perPageNums" onChange="currentPatchPage = 1;changeStep(false)">
                                    <option value="10" selected="selected">10</option>
                                    <option value="25">25</option>
                                    <option value="50">50</option>
                                    <option value="100">100</option>
                                </select>
                            </label>
                            <label>行</label>
                        </div>
                        <div id="pageLabelDiv" class="dataTables_paginate paging_bootstrap pagination">
                            <ul class="pagination pagination-sm">
                            </ul>
                        </div>
                    </footer>

                </table>
            </div><!-- table-responsive -->

        </div><!-- panel-body -->
    </div><!-- panel -->

</div><!-- contentpanel -->

<script src="/static/js/jquery-1.11.1.min.js"></script>
<script src="/static/js/select2.min.js"></script>

<script>
    //每页的条数发生改变时  重新计算分页条数
    function changeStep(onlyChangeStep) {
        var pagelabelDiv = $("#pageLabelDiv ul");
        pagelabelDiv.empty();
        var stepinput = document.getElementById("stepInput")
        step = parseInt(stepinput.options[stepinput.selectedIndex].value);
        var pageNum = Math.ceil(totalCount / step);
        if (currentPage <= 1) {
            pagelabelDiv.append('<li class="disabled"><a href="#">上一页</a></li>')
        } else {
            pagelabelDiv.append('<li class="" onclick="getList(' + (currentPage - 1) + ',' + step + ')" ><a href="#">上一页</a></li>')
        }
        if (pageNum > 6) {
            for (var i = 1; i <= pageNum; i++) {
                if ((i) == currentPage) {
                    pagelabelDiv.append('<li class="active"><a>' + (i) + '</a></li>')
                } else if ((i <= 2)) {
                    pagelabelDiv.append('<li onclick="getList(' + i + ',' + step + ')"><a  href="#">' + (i) + '</a></li>')
                } else if ((i >= currentPage - 1 && (i <= currentPage + 1)) || (i > pageNum - 2)) {
                    pagelabelDiv.append('<li onclick="getList(' + i + ',' + step + ')"><a  href="#">' + (i) + '</a></li>')
                }
            }

        } else {
            for (var i = 1; i <= pageNum; i++) {
                if ((i) == currentPage) {
                    pagelabelDiv.append('<li class="active"><a>' + (i) + '</a></li>')
                } else {
                    pagelabelDiv.append('<li onclick="getList(' + i + ',' + step + ')"><a  href="#">' + (i) + '</a></li>')
                }
            }
        }
        if (currentPage >= pageNum) {
            pagelabelDiv.append('<li class="disabled"><a href="#">下一页</a></li>')
        } else {
            pagelabelDiv.append('<li class="" onclick="getList(' + (currentPage + 1) + ',' + step + ')" ><a href="#">下一页</a></li>')
        }
        if (onlyChangeStep == false) {
            getList(currentPage, step);
        }
    }
    jQuery(document).ready(function() {
        // Select2
        jQuery("#stepInput").select2({
            width: '100%',
            minimumResultsForSearch: -1
        });
    });


    var totalCount = 0
    var currentPage = 1
    var step = 10
    var tablebody
    var currentListData
    var adddata
    var host

    //页面载入后先获取默认条数的数据
    window.onload = function () {
        host = "http://" + window.location.host
        getList(currentPage, step);
    };

    //从API获取数据列表
    function getList(page, tempstep) {
        currentPage = page;
        step = tempstep
        searchList();
    }

    //----------------------------上面为相同部分---------------------------------------------


    //点击提交按钮
    function searchList() {
        $.get(host + "/Stencil/show/" + currentPage + "/step/" + step, null, listToSuccess, "json");
    }

    //从数据库中获取列表成功
    function listToSuccess(response, status, xhr) {
        if (status == "success" && response.reusltCode == "200") {
            currentListData = response.reusltDetail.dataList;
            totalCount = response.totalCount;
            clearDataTable();
            changeStep(true);
            fillTable();
            parent.setMainContentHeight(currentListData.length, 52);
        } else {
            alert(response);
        }

    }

    //清空数据表格
    function clearDataTable() {
        tablebody = $("#maintablebody");
        tablebody.empty();
    }

    //采用本地数组中的数据填充表格
    function fillTable() {
        adddata = "";
        $.each(currentListData, function (index, item) {
            adddata += ("<td class=\"table-min-width\">" + item.image + "</td>");
            adddata += ("<td class=\"table-min-width\">" + item.title + "</td>");
            adddata += ("<td class=\"table-min-width\">" + item.content + "</td>");
            adddata += ("<td class=\"table-min-width\">" + item.price + "</td>");
            adddata += ("<td class=\"table-min-width\">" + item.time + "</td>");
            adddata += "</tr>";

        });
        tablebody.append(adddata);
    }


</script>